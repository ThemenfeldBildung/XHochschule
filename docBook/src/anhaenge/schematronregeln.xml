<?xml version="1.0" standalone="yes" ?>
<?xml-model href="http://www.oasis-open.org/docbook/xml/5.0/rng/docbookxi.rng" schematypens="http://relaxng.org/ns/structure/1.0"?>
<appendix version="5" xml:id="spezifikation.anhang.schematronregeln" xml:lang="de" xmlns="http://docbook.org/ns/docbook">
    <info>
        <title>Schematronregeln</title>
    </info>
    <informaltable frame="all">
        <tgroup cols="4">
            <colspec colwidth="16mm"/>
            <colspec colwidth="26mm"/>
            <colspec colwidth="59mm"/>
            <colspec colwidth="59mm"/>
            <thead>
                <row>
                    <entry>ID</entry>
                    <entry>Eingeschränktes Element</entry>
                    <entry>Funktion</entry>
                    <entry>Fehlermeldung</entry>
                </row>
            </thead>
            <tbody>
                <row>
                    <entry>XHS-0001</entry>
                    <entry>-studienabschnitt : angabenStudienabschnittRentenbescheinigung [1..*]</entry>
                    <entry>if (*:beurlaubungsstatus/code/code = 'http://xhochschule.de/def/xhochschule/1.0/code/beurlaubungsstatus/beurlaubt') then exists(*:beurlaubungsgrund) else empty(*:beurlaubungsgrund)</entry>
                    <entry>XHS-0001 Wenn und nur wenn der Beurlaubungsstatus 'beurlaubt' ist, darf
                        der Beurlaubungsgrund angegeben werden.</entry>
                </row>
                <row>
                    <entry>XHS-0010</entry>
                    <entry>lernzeitmodell</entry>
                    <entry>ends-with(*:code/code/text(),'/vollzeit') or ends-with(*:code/code/text(),'/teilzeit')</entry>
                    <entry>XHS-0010 Das Lernzeitmodell muss in der Immatrikulationsbescheinigung
                        nach BaföG § 9 die Ausprägung 'Teilzeit' oder 'Vollzeit' haben.</entry>
                </row>
                <row>
                    <entry>XHS-0011</entry>
                    <entry>-benotung : angabenBenotung [1]</entry>
                    <entry>exists(*:gesamtnote/*:note)</entry>
                    <entry>XHS-0011 Fehlende Angabe in 'benotung'. 'note' muss angegeben
                        werden.</entry>    
                </row>
                <row>
                    <entry>XHS-0012</entry>
                    <entry>leistungsart</entry>
                    <entry>(exists(*:nichtGelisteterWert) and ends-with(*:code/code/text(), 'wert_nicht_in_liste')) or (not(exists(*:nichtGelisteterWert)) and not(ends-with(*:code/code/text(), 'wert_nicht_in_liste')))</entry>
                    <entry>XHS-0012 Wenn der Wert der Codeliste Leistungsart '~wert_nicht_in_liste'
                        ist, muss das Freitextfeld 'nichtGelisteterWert' angegeben werden. Ansonsten
                        darf das Freitextfeld 'nichtGelisteterWert' nicht angegeben werden.</entry>
                </row>
                <row>
                    <entry>XHS-0013</entry>
                    <entry>leistungsstatus</entry>
                    <entry>(exists(*:nichtGelisteterWert) and ends-with(*:code/code/text(), 'wert_nicht_in_liste')) or (not(exists(*:nichtGelisteterWert)) and not(ends-with(*:code/code/text(), 'wert_nicht_in_liste')))</entry>
                    <entry>XHS-0013 Wenn der Wert der Codeliste Leistungsstatus
                        '~wert_nicht_in_liste' ist, muss das Freitextfeld 'nichtGelisteterWert'
                        angegeben werden. Ansonsten darf das Freitextfeld 'nichtGelisteterWert'
                        nicht angegeben werden.</entry>
                </row>
                <row>
                    <entry>XHS-0014</entry>
                    <entry>lernzeitmodell</entry>
                    <entry>(exists(*:nichtGelisteterWert) and ends-with(*:code/code/text(), 'wert_nicht_in_liste')) or (not(exists(*:nichtGelisteterWert)) and not(ends-with(*:code/code/text(), 'wert_nicht_in_liste')))</entry>
                    <entry>XHS-0014 Wenn der Wert der Codeliste Lernzeitmodell
                        '~wert_nicht_in_liste' ist, muss das Freitextfeld 'nichtGelisteterWert'
                        angegeben werden. Ansonsten darf das Freitextfeld 'nichtGelisteterWert'
                        nicht angegeben werden.</entry>    
                </row>
                <row>
                    <entry>XHS-0015</entry>
                    <entry>beurlaubungsstatus</entry>
                    <entry>(exists(*:nichtGelisteterWert) and ends-with(*:code/code/text(), 'wert_nicht_in_liste')) or (not(exists(*:nichtGelisteterWert)) and not(ends-with(*:code/code/text(), 'wert_nicht_in_liste')))</entry>
                    <entry>XHS-0015 Wenn der Wert der Codeliste Beurlaubungsstatus
                        '~wert_nicht_in_liste' ist, muss das Freitextfeld 'nichtGelisteterWert'
                        angegeben werden. Ansonsten darf das Freitextfeld 'nichtGelisteterWert'
                        nicht angegeben werden.</entry>
                </row>
                <row>
                    <entry>XHS-0016</entry>
                    <entry>immatrikulationsstatus</entry>
                    <entry>(exists(*:nichtGelisteterWert) and ends-with(*:code/code/text(), 'wert_nicht_in_liste')) or (not(exists(*:nichtGelisteterWert)) and not(ends-with(*:code/code/text(), 'wert_nicht_in_liste')))</entry>
                    <entry>XHS-0016 Wenn der Wert der Codeliste Immatrikulationsstatus
                        '~wert_nicht_in_liste' ist, muss das Freitextfeld 'nichtGelisteterWert'
                        angegeben werden. Ansonsten darf das Freitextfeld 'nichtGelisteterWert'
                        nicht angegeben werden.</entry>    
                </row>
                <row>
                    <entry>XHS-0017</entry>
                    <entry>lateinischeEhrenbezeichnung</entry>
                    <entry>(exists(*:nichtGelisteterWert) and ends-with(*:code/code/text(), 'wert_nicht_in_liste')) or (not(exists(*:nichtGelisteterWert)) and not(ends-with(*:code/code/text(), 'wert_nicht_in_liste')))</entry>
                    <entry>XHS-0017 Wenn der Wert der Codeliste LateinischeEhrenbezeichnung
                        '~wert_nicht_in_liste' ist, muss das Freitextfeld 'nichtGelisteterWert'
                        angegeben werden. Ansonsten darf das Freitextfeld 'nichtGelisteterWert'
                        nicht angegeben werden.</entry>    
                </row>
                <row>
                    <entry>XHS-0018</entry>
                    <entry>-note : string [0..1]</entry>
                    <entry>(matches(., '^(6([,.]0)?|([1-5]([,.]\d+)))|[A-F][+-]?$'))</entry>
                    <entry>XHS-0018 Im Feld Note dürfen nur die folgenden Formate angegeben werden:
                        1. 'Zahl-Komma-Zahl' Beispiel "2,6" oder 2. 'Buchstabe A-F (+/-)' Beispiel
                        "A" oder "A+".</entry>    
                </row>
                <row>
                    <entry>XHS-0019</entry>
                    <entry>-note : string [0..1]</entry>
                    <entry>(matches(., '^(6([,.]0)?|([1-5]([,.]\d+)))|[A-F][+-]?$'))</entry>
                    <entry>XHS-0019 Im Feld Note dürfen nur die folgenden Formate angegeben werden:
                        1. 'Zahl-Komma-Zahl' Beispiel "2,6" oder 2. 'Buchstabe A-F (+/-)' Beispiel
                        "A" oder "A+".</entry>    
                </row>
                <row>
                    <entry>XHS-0020</entry>
                    <entry>Leistung</entry>
                    <entry>if(ends-with(*:leistungsart/leistungsartCode/code/text(), 'klausur') or  ends-with(*:leistungsart/leistungsartCode/code/text(), 'pruefung')) then not(exists(*:beschreibung/*:umfangInSWS)) else (not(exists(*:beschreibung/*:umfangInSWS)) or exists(*:beschreibung/*:umfangInSWS))</entry>
                    <entry>XHS-0020 Der Wert 'UmfangInSWS' darf nicht angegeben werden, wenn der
                        Inhalt des Codewertes von 'leistungsart' mit 'klausur' oder 'pruefung'
                        endet. Bei Prüfungen und Klausuren handelt es sich um punktuelle Ereignisse,
                        die nicht über das Semester verteilt sind.</entry>    
                </row>
                <row>
                    <entry>XHS-0021</entry>
                    <entry>Leistung</entry>
                    <entry>if(ends-with(*:leistungsart/code/code/text(), 'studienfach') or ends-with(*:leistungsart/code/code/text(), 'studiengang')) then (exists(*:unbedenklichkeitsvermerk) or not(exists(*:unbedenklichkeitsvermerk))) else not(exists(*:unbedenklichkeitsvermerk))</entry>
                    <entry>XHS-0021 Der Unbedenklichkeitsvermerk darf nur angegeben werden, wenn der
                        Wert der Codeliste Leistungsart auf 'studienfach' oder 'studiengang' gesetzt
                        wurde.</entry>    
                </row>
                <row>
                    <entry>XHS-0022</entry>
                    <entry>Leistung</entry>
                    <entry>if(ends-with(*:leistungsart/code/code/text(), 'studienfach') or ends-with(*:leistungsart/code/code/text(), 'studiengang')) then (exists(*:angestrebterAbschluss) or not(exists(*:angestrebterAbschluss))) else not(exists(*:angestrebterAbschluss))</entry>
                    <entry>XHS-0022 Der angestrebte Abschluss darf nur angegeben werden, wenn der
                        Wert der Codeliste Leistungsart auf 'studienfach' oder 'studiengang' gesetzt
                        wurde.</entry>    
                </row>
                <row>
                    <entry>XHS-0023</entry>
                    <entry>Leistung</entry>
                    <entry>if(ends-with(*:leistungsart/code/code/text(), 'studienfach') or ends-with(*:leistungsart/code/code/text(), 'studiengang')) then (exists(*:fachsemester) or not(exists(*:fachsemester))) else not(exists(*:fachsemester))</entry>
                    <entry>XHS-0023 Das Fachsemester darf nur angegeben werden, wenn der Wert der
                        Codeliste Leistungsart auf 'studienfach' oder 'studiengang' gesetzt
                        wurde.</entry>    
                </row>
                <row>
                    <entry>XHS-0024</entry>
                    <entry>Leistung</entry>
                    <entry>if(ends-with(*:leistungsart/code/code/text(), 'studienfach') or ends-with(*:leistungsart/code/code/text(), 'studiengang')) then (exists(*:schluesselISCED2011) or not(exists(*:schluesselISCED2011))) else not(exists(*:schluesselISCED2011))</entry>
                    <entry>XHS-0024 Der Schlüssel nach ISCED2011 darf nur angegeben werden, wenn der
                        Wert der Codeliste Leistungsart auf 'studienfach' oder 'studiengang' gesetzt
                        wurde.</entry>    
                </row>
                <row>
                    <entry>XHS-0025</entry>
                    <entry>Leistung</entry>
                    <entry>if(ends-with(*:leistungsart/code/code/text(), 'studienfach') or ends-with(*:leistungsart/code/code/text(), 'studiengang')) then (exists(*:schluesselISCEDF2013) or not(exists(*:schluesselISCEDF2013))) else not(exists(*:schluesselISCEDF2013))</entry>
                    <entry>XHS-0025 Der Schlüssel nach ISCEDF2013 darf nur angegeben werden, wenn
                        der Wert der Codeliste Leistungsart auf 'studienfach' oder 'studiengang'
                        gesetzt wurde.</entry>    
                </row>
                <row>
                    <entry>XHS-0026</entry>
                    <entry>Leistung</entry>
                    <entry>if(ends-with(*:leistungsart/code/code/text(), 'studienfach') or ends-with(*:leistungsart/code/code/text(), 'studiengang')) then (exists(*:schluesselEQF) or not(exists(*:schluesselEQF))) else not(exists(*:schluesselEQF))</entry>
                    <entry>XHS-0026 Der Schlüssel nach EQF darf nur angegeben werden, wenn der Wert
                        der Codeliste Leistungsart auf 'studienfach' oder 'studiengang' gesetzt
                        wurde.</entry>    
                </row>
                <row>
                    <entry>XHS-0027</entry>
                    <entry>Leistung</entry>
                    <entry>if(ends-with(*:benotet/text(),'true') or ends-with(*:benotet/text(),'1')) then (exists(*:leistungsbenotungsstatus)) else (not(exists(*:leistungsbenotungsstatus)))</entry>
                    <entry>XHS-0027 Wenn eine Leistung benotet ist (boolean 'benotet' = 'true' oder
                        '1'), muss der Leistungsbenotungsstatus angegeben werden. Ansonsten darf der
                        Leistungsbenotungsstatus nicht angegeben werden."</entry>    
                </row>
                <row>
                    <entry>XHS-0028</entry>
                    <entry>Leistung</entry>
                    <entry>if(ends-with(*:benotet/text(),'true') or ends-with(*:benotet/text(),'1')) then (exists(*:benotung)) else (not(exists(*:benotung)))</entry>
                    <entry>XHS-0028 Wenn eine Leistung benotet ist (boolean 'benotet' = 'true' oder
                        '1'), muss die Benotung angegeben werden. Ansonsten darf die Benotung nicht
                        angegeben werden.</entry>    
                </row>
                <row>
                    <entry>XHS-0029</entry>
                    <entry>Leistung</entry>
                    <entry>((ends-with(*:leistungsart/code/code/text(), 'modul')) and (not(exists(*:beschreibung/*:modulbeschreibungNachKMK)) or exists(*:beschreibung/*:modulbeschreibungNachKMK))) or (not(ends-with(*:leistungsart/code/code/text(), 'modul')) and (not(exists(*:beschreibung/*:modulbeschreibungNachKMK))))</entry>
                    <entry>XHS-0029 Nur wenn der Wert der Codeliste Leistungsart auf 'modul' gesetzt
                        wurde, soll die Beschreibung nach den Vorgaben der KMK ausgefüllt werden.
                        Ansonsten darf die Beschreibung nicht nach den Vorgaben der KMK ausgefüllt
                        werden.</entry>    
                </row>
                <row>
                    <entry>XHS-0030</entry>
                    <entry>Leistungsbenotungsstatus</entry>
                    <entry>(exists(*:nichtGelisteterWert) and ends-with(*:code/code/text(), 'wert_nicht_in_liste')) or (not(exists(*:nichtGelisteterWert)) and not(ends-with(*:code/code/text(), 'wert_nicht_in_liste')))</entry>
                    <entry>XHS-0030 Wenn der Wert der Codeliste Leistungsbenotungsstatus
                        '~wert_nicht_in_liste' ist, muss das Freitextfeld 'nichtGelisteterWert'
                        angegeben werden. Ansonsten darf das Freitextfeld 'nichtGelisteterWert'
                        nicht angegeben werden.</entry>    
                </row>
                <row>
                    <entry>XHS-0031</entry>
                    <entry>Leistung</entry>
                    <entry>if(ends-with(*:leistungsart/code/code/text(), 'studienfach') or ends-with(*:leistungsart/code/code/text(), 'studiengang')) then (exists(*:faecherschluesseDESTATIS) or not(exists(*:faecherschluesseDESTATIS))) else not(exists(*:faecherschluesseDESTATIS))</entry>
                    <entry>XHS-0031 Der Fächerschlüssel nach Destatis darf nur angegeben werden,
                        wenn der Wert der Codeliste Leistungsart auf 'studienfach' oder
                        'studiengang' gesetzt wurde.</entry>    
                </row>
                <row>
                    <entry>XHS-0032</entry>
                    <entry>rentenbescheinigung</entry>
                    <entry>not(exists(*:rentenversicherungsnummer/gueltigkeit/ende))</entry>
                    <entry>XHS-0032 Die Rentenversicheurngsnummer ist ab Geburt ein Leben lang
                        gültig. Das Ablaufdatum darf nicht angezeigt werden.</entry>    
                </row>
            </tbody>
        </tgroup>
    </informaltable>
</appendix>
